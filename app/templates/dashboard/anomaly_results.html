{% extends 'dashboard/base.html' %}

{% block title %}Anomaly Results - EdFlow{% endblock %}

{% block page_heading %}Student Anomaly Detection{% endblock %}

{% block content %}
<div class="dashboard-card anomaly-results-card animated-slide-in-up">
    <h2><i class="fas fa-exclamation-triangle icon-purple"></i> Suspicious Student Activities</h2>
    <p class="card-description">
        Below is a list of students identified as potential anomalies based on their academic and behavioral data.
        A lower anomaly score indicates a higher likelihood of being an outlier.
    </p>

    {% if anomalies %}
    <div class="table-responsive">
        <table class="table table-dark table-striped table-hover">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Attendance (%)</th>
                    <th>Study Hours/Day</th>
                    <th>Exam Score</th>
                    <th>Social Media Hours</th>
                    <th>Sleep Hours</th>
                    <th>Mental Health Rating</th>
                    <th>Extracurricular Participation</th>
                    <th>Anomaly Score</th>
                </tr>
            </thead>
            <tbody>
                {% for student in anomalies %}
                <tr class="table-row-anomaly"> {# Optional: Add a class for styling anomalies #}
                    <td>{{ student.student_id }}</td>
                    <td>{{ student.age }}</td>
                    <td>{{ student.gender }}</td>
                    <td>{{ student.attendance_percentage }}</td>
                    <td>{{ student.study_hours_per_day }}</td>
                    <td>{{ student.exam_score }}</td>
                    <td>{{ student.social_media_hours }}</td>
                    <td>{{ student.sleep_hours }}</td>
                    <td>{{ student.mental_health_rating }}</td>
                    <td>{{ student.extracurricular_participation }}</td>
                    <td><span class="badge bg-danger">{{ student.anomaly_score }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center mt-4" role="alert">
        No anomalous student behaviors detected at this time, or data could not be loaded.
    </div>
    {% endif %}

    <div class="mt-4 text-center">
        <p class="text-muted">
            <em>Note: Anomaly detection is an experimental feature. Further investigation may be required for identified students.</em>
        </p>
    </div>
</div>

<style>
    /* Add custom styles for the anomaly results page */
    .anomaly-results-card {
        background-color: #2a2a4a; /* Darker background for the card */
        color: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .anomaly-results-card h2 {
        color: #e0b0ff; /* Purple-ish title */
        margin-bottom: 15px;
    }
    .anomaly-results-card .card-description {
        color: #bbb;
        margin-bottom: 25px;
    }
    .table-responsive {
        margin-top: 20px;
    }
    .table-dark thead th {
        background-color: #3e3e6b; /* Darker header for table */
        color: white;
    }
    .table-dark tbody tr {
        background-color: #333355; /* Darker rows */
    }
    .table-dark tbody tr:hover {
        background-color: #4a4a7a; /* Lighter on hover */
    }
    .badge.bg-danger {
        background-color: #dc3545 !important;
    }
    .alert-info {
        background-color: #2196F3; /* Bootstrap info blue */
        border-color: #2196F3;
        color: white;
    }
</style>
{% endblock %}