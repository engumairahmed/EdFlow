{% extends "dashboard/base.html" %}

{% block title %}HDFS-EdFlow{% endblock %}

{% block page_heading %}Upload Your Data to HDFS{% endblock %}

{% block content %}
<div class="dashboard-card upload-card ">
  <h2>Upload Data File to HDFS</h2>
  <p>Please upload your data in <strong>CSV</strong> or <strong>Excel (.xlsx)</strong> format. Max file size: 100MB.</p>

  <form method="POST" enctype="multipart/form-data" action="/dashboard/upload-data">
    <!-- Drag & Drop Area -->
    <div id="drop-area" class="upload-drop-area">
      <i class="fas fa-cloud-upload-alt upload-icon"></i>
      <p>Drag & drop your file here, or</p>
      <input type="file" id="file-input" name="dataset" accept=".csv,.xlsx" hidden>
      <label for="file-input" class="btn btn-primary browse-btn">Browse File</label>
    </div>

    <!-- File Name -->
    <div id="file-name" class="selected-file-name"></div>

    <!-- Spinner -->
    <div id="upload-spinner" style="display:none; margin-top: 10px;">
      <i class="fas fa-spinner fa-spin"></i> Preparing file...
    </div>


    <!-- Submit Button -->
    <button type="submit" id="submit-btn" class="btn btn-success" style="display:none; margin-top: 15px;">
      <i class="fas fa-upload"></i> Upload Data
    </button>

  </form>
</div>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileInput = document.getElementById('file-input');
  const fileName = document.getElementById('file-name');
  const spinner = document.getElementById('upload-spinner');
  const submitBtn = document.getElementById('submit-btn');

  // Click to Browse fallback
  dropArea.addEventListener('click', () => fileInput.click());

  // Handle file selection
  fileInput.addEventListener('change', handleFile);

  // Handle drag & drop
  dropArea.addEventListener('dragover', e => {
    e.preventDefault();
    dropArea.classList.add('dragover');
  });

  dropArea.addEventListener('dragleave', e => {
    e.preventDefault();
    dropArea.classList.remove('dragover');
  });

  dropArea.addEventListener('drop', e => {
    e.preventDefault();
    dropArea.classList.remove('dragover');
    fileInput.files = e.dataTransfer.files;
    handleFile();
  });

  function handleFile() {
    const file = fileInput.files[0];
    if (file) {
      fileName.innerText = `Selected: ${file.name}`;
      spinner.style.display = 'inline-block';

      // Simulate preparing file on browser side
      setTimeout(() => {
        spinner.style.display = 'none';
        submitBtn.style.display = 'inline-block';
      }, 1500);
    }
  }
</script>

<style>
  .upload-drop-area {
    border: 2px dashed #ccc;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: border 0.3s;
  }
  .upload-drop-area.dragover {
    border-color: #1f9ba5;
    background-color: #f8f8f8;
  }
  .selected-file-name {
    margin-top: 10px;
    font-weight: bold;
  }
</style>
{% endblock %}
